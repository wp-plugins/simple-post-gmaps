if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,'');};}
geoXML3=window.geoXML3||{};geoXML3.parser=function(options){var parserOptions=geoXML3.combineOptions(options,{singleInfoWindow:false,processStyles:true,zoom:true});var docs=[];var lastMarker;var parse=function(urls){if(typeof urls==='string'){urls=[urls];}
var internals={docSet:[],remaining:urls.length,parserOnly:!parserOptions.afterParse};var thisDoc;for(var i=0;i<urls.length;i++){thisDoc={url:urls[i],internals:internals};internals.docSet.push(thisDoc);geoXML3.fetchXML(thisDoc.url,function(responseXML){render(responseXML,thisDoc);});}};var hideDocument=function(doc){var i;for(i=0;i<doc.markers.length;i++){this.markers[i].set_visible(false);}
for(i=0;i<doc.overlays.length;i++){doc.overlays[i].setOpacity(0);}};var showDocument=function(doc){var i;for(i=0;i<doc.markers.length;i++){doc.markers[i].set_visible(true);}
for(i=0;i<doc.overlays.length;i++){doc.overlays[i].setOpacity(doc.overlays[i].percentOpacity_);}};var render=function(responseXML,doc){if(!responseXML){geoXML3.log('Unable to retrieve '+doc.url);if(parserOptions.failedParse){parserOptions.failedParse(doc);}}else if(!doc){throw'geoXML3 internal error: render called with null document';}else{doc.styles={};doc.placemarks=[];doc.groundOverlays=[];if(parserOptions.zoom&&!!parserOptions.map)
doc.bounds=new google.maps.LatLngBounds();var styleID,iconNodes,i;var styleNodes=responseXML.getElementsByTagName('Style');for(i=0;i<styleNodes.length;i++){styleID=styleNodes[i].getAttribute('id');iconNodes=styleNodes[i].getElementsByTagName('Icon');if(!!iconNodes.length){doc.styles['#'+styleID]={href:geoXML3.nodeValue(iconNodes[0].getElementsByTagName('href')[0])};}}
if(!!parserOptions.processStyles||!parserOptions.createMarker){processStyles(doc);}
var placemark,node,coords,path;var placemarkNodes=responseXML.getElementsByTagName('Placemark');for(i=0;i<placemarkNodes.length;i++){node=placemarkNodes[i];placemark={name:geoXML3.nodeValue(node.getElementsByTagName('name')[0]),description:geoXML3.nodeValue(node.getElementsByTagName('description')[0]),styleUrl:geoXML3.nodeValue(node.getElementsByTagName('styleUrl')[0])};placemark.style=doc.styles[placemark.styleUrl]||{};if(/^https?:\/\//.test(placemark.description)){placemark.description='<a href="'+placemark.description+'">'+placemark.description+'</a>';}
coords=geoXML3.nodeValue(node.getElementsByTagName('coordinates')[0]).trim();coords=coords.replace(/\s+/g,' ').replace(/, /g,',');path=coords.split(' ');if(path.length===1){coords=path[0].split(',');placemark.point={lat:parseFloat(coords[1]),lng:parseFloat(coords[0]),alt:parseFloat(coords[2])};if(!!doc.bounds){doc.bounds.extend(new google.maps.LatLng(placemark.point.lat,placemark.point.lng));}
if(!!parserOptions.createMarker){parserOptions.createMarker(placemark,doc);}else{createMarker(placemark,doc);}}}
var groundOverlay,color,transparency;var groundNodes=responseXML.getElementsByTagName('GroundOverlay');for(i=0;i<groundNodes.length;i++){node=groundNodes[i];groundOverlay={name:geoXML3.nodeValue(node.getElementsByTagName('name')[0]),description:geoXML3.nodeValue(node.getElementsByTagName('description')[0]),icon:{href:geoXML3.nodeValue(node.getElementsByTagName('href')[0])},latLonBox:{north:parseFloat(geoXML3.nodeValue(node.getElementsByTagName('north')[0])),east:parseFloat(geoXML3.nodeValue(node.getElementsByTagName('east')[0])),south:parseFloat(geoXML3.nodeValue(node.getElementsByTagName('south')[0])),west:parseFloat(geoXML3.nodeValue(node.getElementsByTagName('west')[0]))}};if(!!doc.bounds){doc.bounds.union(new google.maps.LatLngBounds(new google.maps.LatLng(groundOverlay.latLonBox.south,groundOverlay.latLonBox.west),new google.maps.LatLng(groundOverlay.latLonBox.north,groundOverlay.latLonBox.east)));}
color=geoXML3.nodeValue(node.getElementsByTagName('color')[0]);if((color!=='')&&(color.length==8)){transparency=parseInt(color.substring(0,2),16);groundOverlay.opacity=Math.round((255-transparency)/2.55);}else{groundOverlay.opacity=100;}
if(!!parserOptions.createOverlay){parserOptions.createOverlay(groundOverlay,doc);}else{createOverlay(groundOverlay,doc);}}
if(!!doc.bounds){doc.internals.bounds=doc.internals.bounds||new google.maps.LatLngBounds();doc.internals.bounds.union(doc.bounds);}
if(!!doc.styles||!!doc.markers||!!doc.overlays){doc.internals.parserOnly=false;}
doc.internals.remaining-=1;if(doc.internals.remaining===0){if(!!doc.internals.bounds){parserOptions.map.fitBounds(doc.internals.bounds);}
if(parserOptions.afterParse){parserOptions.afterParse(doc.internals.docSet);}
if(!doc.internals.parserOnly){docs.concat(doc.internals.docSet);}}}};var processStyles=function(doc){var stdRegEx=/\/(red|blue|green|yellow|lightblue|purple|pink|orange)(-dot)?\.png/;for(var styleID in doc.styles){if(!!doc.styles[styleID].href){doc.styles[styleID].icon=new google.maps.MarkerImage(doc.styles[styleID].href,new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(16,12));if(stdRegEx.test(doc.styles[styleID].href)){doc.styles[styleID].shadow=new google.maps.MarkerImage('http://maps.google.com/mapfiles/ms/micons/msmarker.shadow.png',new google.maps.Size(59,32),new google.maps.Point(0,0),new google.maps.Point(16,12));}else if(doc.styles[styleID].href.indexOf('-pushpin.png')>-1){doc.styles[styleID].shadow=new google.maps.MarkerImage('http://maps.google.com/mapfiles/ms/micons/pushpin_shadow.png',new google.maps.Size(59,32),new google.maps.Point(0,0),new google.maps.Point(16,12));}else{doc.styles[styleID].shadow=new google.maps.MarkerImage(doc.styles[styleID].href.replace('.png','.shadow.png'),new google.maps.Size(59,32),new google.maps.Point(0,0),new google.maps.Point(16,12));}}}};var createMarker=function(placemark,doc){var markerOptions=geoXML3.combineOptions(parserOptions.markerOptions,{map:parserOptions.map,position:new google.maps.LatLng(placemark.point.lat,placemark.point.lng),title:placemark.name,zIndex:Math.round(-placemark.point.lat*100000),icon:placemark.style.icon,shadow:placemark.style.shadow});var marker=new google.maps.Marker(markerOptions);var infoWindowOptions=geoXML3.combineOptions(parserOptions.infoWindowOptions,{content:'<div class="infowindow"><h3>'+placemark.name+'</h3><div>'+placemark.description+'</div></div>',pixelOffset:new google.maps.Size(0,2)});marker.infoWindow=new google.maps.InfoWindow(infoWindowOptions);google.maps.event.addListener(marker,'click',function(){if(!!parserOptions.singleInfoWindow){if(!!lastMarker&&!!lastMarker.infoWindow){lastMarker.infoWindow.close();}
lastMarker=this;}
this.infoWindow.open(this.map,this);});if(!!doc){doc.markers=doc.markers||[];doc.markers.push(marker);}
return marker;};var createOverlay=function(groundOverlay,doc){if(!window.ProjectedOverlay){throw'geoXML3 error: ProjectedOverlay not found while rendering GroundOverlay from KML';}
var bounds=new google.maps.LatLngBounds(new google.maps.LatLng(groundOverlay.latLonBox.south,groundOverlay.latLonBox.west),new google.maps.LatLng(groundOverlay.latLonBox.north,groundOverlay.latLonBox.east));var overlayOptions=geoXML3.combineOptions(parserOptions.overlayOptions,{percentOpacity:groundOverlay.opacity});var overlay=new ProjectedOverlay(parserOptions.map,groundOverlay.icon.href,bounds,overlayOptions);if(!!doc){doc.overlays=doc.overlays||[];doc.overlays.push(overlay);}
return};return{options:parserOptions,docs:docs,parse:parse,hideDocument:hideDocument,showDocument:showDocument,processStyles:processStyles,createMarker:createMarker,createOverlay:createOverlay};};geoXML3.log=function(msg){if(!!window.console){console.log(msg);}};geoXML3.combineOptions=function(overrides,defaults){var result={};if(!!overrides){for(var prop in overrides){if(overrides.hasOwnProperty(prop)){result[prop]=overrides[prop];}}}
if(!!defaults){for(prop in defaults){if(defaults.hasOwnProperty(prop)&&(result[prop]===undefined)){result[prop]=defaults[prop];}}}
return result;};geoXML3.fetchers=[];geoXML3.fetchXML=function(url,callback){function timeoutHandler(){callback();};var xhrFetcher;if(!!geoXML3.fetchers.length){xhrFetcher=geoXML3.fetchers.pop();}else{if(!!window.XMLHttpRequest){xhrFetcher=new window.XMLHttpRequest();}else if(!!window.ActiveXObject){xhrFetcher=new window.ActiveXObject('Microsoft.XMLHTTP');}}
if(!xhrFetcher){geoXML3.log('Unable to create XHR object');callback(null);}else{xhrFetcher.open('GET',url,true);xhrFetcher.onreadystatechange=function(){if(xhrFetcher.readyState===4){if(!!xhrFetcher.timeout)
clearTimeout(xhrFetcher.timeout);if(xhrFetcher.status>=400){geoXML3.log('HTTP error '+xhrFetcher.status+' retrieving '+url);callback();}else{callback(xhrFetcher.responseXML);}
geoXML3.fetchers.push(xhrFetcher);}};xhrFetcher.timeout=setTimeout(timeoutHandler,60000);xhrFetcher.send(null);}};geoXML3.nodeValue=function(node){if(!node){return'';}else{return(node.innerText||node.text||node.textContent).trim();}};