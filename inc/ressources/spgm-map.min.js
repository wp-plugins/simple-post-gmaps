jQuery(function(){jQuery(".gmaps").each(function(a,b){var c={map:"",form:"",pType:"",taxoR:"",taxoF:"",term:"",zoomS:10,geoXml:"",options:"",filterForm:"",search:false,searchForm:"",searchField:"",searchButton:"",gLocalSearch:"",geoCoder:"",gCurrentResults:[],init:function(a){var b=this;this.form=jQuery(a).closest("div.spgmWrapper").find("form.spgmSettings");this.pType=this.form.find("input[name=spgm_post_type]").val();this.taxoR=this.form.find("input[name=spgm_requestTaxo]").val();this.term=this.form.find("input[name=spgm_requestTerm]").val();this.taxoF=this.form.find("input[name=spgm_firstTaxo]").val();this.zoomS=this.form.find("input[name=spgm_zoom]").val();this.searchForm=jQuery(a).closest("div.spgmWrapper").find("form.spgmSearch");this.searchField=this.searchForm.find('input[name="spgm_search"]');this.searchButton=this.searchForm.find('input[name="spgm_ok"]');if(jQuery(a).hasClass("search")){this.search=true}this.searchForm.submit(function(a){a.preventDefault();b.centerMap()});this.options={zoom:parseInt(this.zoomS),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,navigationControl:true,center:new google.maps.LatLng(48.892783,2.342877)};this.geoCoder=new google.maps.Geocoder;if(this.term==""){this.refreshMap("&post_type="+this.pType+this.taxoR)}this.filterForm=jQuery(a).closest("div.spgmWrapper").find(".termsFiltering");this.filterForm.find("input").click(function(){b.filter()});if(this.term!=""){b.filterOneTerm()}},refreshMap:function(a){var c=this;this.map=new google.maps.Map(b,this.options);this.geoXml=new geoXML3.parser({map:this.map});this.geoXml.parse(geoxml3L10n.kml_url+a)},centerMap:function(a){var b=this;var c="("+b.map.getCenter().lat()+", "+b.map.getCenter().lng()+")";b.geoCoder.geocode({address:b.searchField.val(),partialmatch:true},function(a,c){if(c=="OK"&&a.length>0){b.map.setCenter(new google.maps.LatLng(a[0].geometry.location.Pa,a[0].geometry.location.Qa));b.map.setZoom(13)}})},filter:function(){var a="";var b="";var c=this.filterForm.find("input:checked");if(c=="")return false;c.each(function(c,d){b+="&taxonomiesFilter[]="+jQuery(d).closest("div").attr("class");a+="&termsFilter[]="+d.value});this.refreshMap("&post_type="+this.pType+a+b+"&taxonomiesFilter[]="+this.taxoF)},filterOneTerm:function(){var a="&termsFilter[]="+this.term;this.refreshMap("&post_type="+this.pType+this.taxoF+a)}};c.init(b)})})